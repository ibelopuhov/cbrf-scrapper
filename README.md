# Тестовое задание: Скрейпинг исторической динамики валютного курса заданной валюты с сайта ЦБ РФ

## Установка и запуск скрипта 
* распаковать архив с программой и перейти в его корневую папку:  
`unzip project-cbr.zip`  
`cd project-cbr`  

* создать виртуальную среду python версии 3.9 и установить все требуемые зависимости из файла requirements.txt: например для Linux-совместимой ОС последовательность команд может выглядеть следующим образом:    
`python3 -m venv venv`  
`source venv/bin/activate`  
`pip3 install -r requirements.txt`  

* Далее можно выполнить тесты, для валидации установленного ПО:  
`pytest dev_tests_runner.py`  
`pytest prod_tests_runner.py`  

* Если тесты завершились успешно, то можно пользоваться скриптом следующим образом:  
`python3 run.py -h` - выводит подсказку о существующих ключах скрипта  
`python3 run.py init-db` - создать и инициализировать БД в файле cbrf_currencies.db в папке запуска скрипта    
`python3 run.py scrap-currency "Наменование валюты"` - выполнить скрейпинг валюты и записать её данные в SQLite БД.  
`python3 run.py dump-currency "Наменование валюты"` - выдать данные о валюте на экран из БД  
`python3 run.py delete-db` - ну и в конце можно удалить файл БД (со всеми данными!!!)  



## Исходные данные

Скрейпинг исторической динамики валютного курса заданной валюты (венгерский форинт, гонконгский доллар и т.п.) с сайта ЦБР в любую реляционную базу данных (за весь период наблюдений).

Дано: URL https://cbr.ru/currency_base/dynamics/, название валюты в том виде, в котором она записана на сайте, например: “фунт стерлингов Соединен”.

Ожидаемый результат программы на Python 3: таблица или несколько таблиц в любой реляционной базе данных с ежедневным курсом заданной валюты.

Внимание: запрос к API ЦБР не засчитывается как решенное тестовое задание.

Ожидаемый результат выполнения задания: zip-архив git-репозитория с полной историей разработки, и как минимум:

* с файлом README.md в корневой директории с инструкциями по запуску проекта,
* файлом requirements.txt для создания виртуального окружения,
* файлом run.py для осуществления скрейпинга.

## Лог разработки

### Анализ исходных данных
Выполнение первичного анализа указанной в задании страницы сайта (https://cbr.ru/currency_base/dynamics/), анализ формы запроса, ее переменных 
(тип получаемого результата, формат диапазона дат и возможные значения кодов валют и их наименований в combo box-е),
загрузка типичных страниц в проект - основной и одной из валют для анализа (чтобы не обращаться напрямую к сайту)   

**Итого:** 
* загружены основные 2 страницы - базовая и страница данных по валюте R01660. Запрос на данные делается методом GET и указанием 3 параметров (что есть на форме запроса: UniDbQuery.VAL_NM_RQ=R01660 UniDbQuery.From=01.12.1992 UniDbQuery.To=25.12.2021 id валюты, начальная и конечная дата наблюдения соответственно) 
* Созданы первые тесты. 
* Анализ страниц показал, что можно выгрузить из combo-box все наименования валют и их коды (идентификаторы). Так же есть данные о минимальной и максимальной возможной даты для запроса.
* Не все валюты имеют данные за каждый день (неполные данные или таковы были торги)
* Некоторые валюты (4 штуки) имеют несколько наименований, но одинаковый код.

### План атаки :

* Парсер базовой формы на предмет получения списка валют и начальной и конечной даты наблюдения
* Парсер основной таблицы данных
* методы получения данных с сайты (requests)
* менеджер инициализации БД и сохранения таймлайнов. Скорее всего на SQLite и без всяких там ORM типа SQLAlchemy...
* Основной метод run.py - откуда все это запускать (в нем инициализация БД, скраппинг, выдача данных в консоль)
* Тестирование, тестирование, тестирование ...
* Финальные доки, как все это использовать...




